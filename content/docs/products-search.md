# Поиск товаров (Product Search)

Эндпоинт для поиска и фильтрации товаров в каталоге. Все параметры опциональны: можно отправить пустое тело или только нужные поля. Метод — **POST**, тело — JSON.

## Основная информация

- **Метод:** POST  
- **Адрес:** `api/products/search`  
- **Тип формы:** filters  

Используйте параметры ниже в теле запроса. Список полей с типами и допустимыми значениями также отображается в блоке **Request Body Parameters** на этой странице (данные подставляются из API).

## Описание параметров

### Идентификация и поиск

| Ключ в запросе | Описание | Тип поля | Обязательность | Пример значения |
|----------------|----------|----------|----------------|------------------|
| `id` | ID одного товара | DecimalField | опционально | `123` |
| `id_in` | Несколько ID через запятую | DecimalInField | опционально | `"1,2,3"` |
| `search_string` | Строка поиска по названию/описанию | CharField | опционально | `"ноутбук"` |
| `categories` | ID категорий (можно несколько) | ModelMultipleChoiceField | опционально | `[1, 2]` |
| `product_group` | Группа товаров (можно несколько) | ModelMultipleChoiceField | опционально | `[5]` |
| `is_related_for` | Показывать только товары, связанные с указанным товаром (один ID) | ModelChoiceField | опционально | `42` |

### Цена

| Ключ в запросе | Описание | Тип поля | Обязательность | Пример значения |
|----------------|----------|----------|----------------|------------------|
| `price_from` | Цена от | DecimalField | опционально | `30000` |
| `price_to` | Цена до | DecimalField | опционально | `80000` |
| `price_currency` | Валюта | ModelChoiceField | опционально | `"USD"` |
| `price_discount_from` | Множитель скидки «больше чем» | DecimalField | опционально | `0.1` |
| `price_discount_to` | Множитель скидки «меньше чем» | DecimalField | опционально | `0.5` |

### Продавец и производитель

| Ключ в запросе | Описание | Тип поля | Обязательность | Пример значения |
|----------------|----------|----------|----------------|------------------|
| `product_owner` | ID владельцев товара (можно несколько) | ModelMultipleChoiceField | опционально | `[10, 20]` |
| `product_owner_name` | Имя продавца (текстовый поиск) | CharField | опционально | `"Магазин"` |
| `product_manufacture` | Производитель (можно несколько) | ModelMultipleChoiceField | опционально | `[1]` |
| `owner_rating_from` | Минимальный рейтинг продавца | DecimalField | опционально | `4.5` |

### Рейтинг и отзывы

| Ключ в запросе | Описание | Тип поля | Обязательность | Пример значения |
|----------------|----------|----------|----------------|------------------|
| `avg_raiting_from` | Средний рейтинг товара — от | DecimalField | опционально | `4` |
| `avg_raiting_to` | Средний рейтинг товара — до | DecimalField | опционально | `5` |
| `c_aprooved_feedbacks_from` | Количество одобренных отзывов — от | DecimalField | опционально | `10` |
| `c_aprooved_feedbacks_to` | Количество одобренных отзывов — до | DecimalField | опционально | `100` |

### Габариты и вес

Пары «от/до» задают диапазон. Единицы измерения задаются отдельными полями «тип»:

| Ключ в запросе | Описание | Тип поля | Обязательность | Пример значения |
|----------------|----------|----------|----------------|------------------|
| `weight_search_by` | Тип единицы веса | ModelChoiceField | опционально | `"kg"` |
| `weight_from`, `weight_to` | Вес — от и до | DecimalField | опционально | `0.5`, `2` |
| `length_search_by` | Тип единицы длины | ModelChoiceField | опционально | `"cm"` |
| `length_from`, `length_to` | Длина — от и до | DecimalField | опционально | `10`, `50` |
| `width_from`, `width_to` | Ширина — от и до | DecimalField | опционально | `5`, `30` |
| `height_from`, `height_to` | Высота — от и до | DecimalField | опционально | `2`, `20` |

### Логические фильтры (да/нет/не указано)

Во всех полях ниже допустимы три значения: `unknown`, `true`, `false`.

| Ключ в запросе | Описание | Тип поля | Обязательность | Пример значения |
|----------------|----------|----------|----------------|------------------|
| `subscription_exists` | Загружать ли пользовательские подписки вместе с результатами. | NullBooleanField | опционально | `"true"` |
| `show_whishlist` | Показывать только товары из списка желаемого (требуется авторизация). | NullBooleanField | опционально | `"true"` |
| `only_featured` | Только избранные (featured) товары. | NullBooleanField | опционально | `"true"` |
| `only_new` | Только новые товары. | NullBooleanField | опционально | `"true"` |
| `with_discount` | Только товары со скидкой. | NullBooleanField | опционально | `"true"` |

### Сортировка

Один из вариантов сортировки. Значение с минусом (`-...`) — по убыванию.

| Ключ в запросе | Описание | Тип поля | Обязательность | Пример значения |
|----------------|----------|----------|----------------|------------------|
| `ordering` | Порядок сортировки (один из вариантов ниже) | ChoiceExactField | опционально | `"-popularity"` |

**Допустимые значения `ordering`:**

- `popularity`, `-popularity` — по популярности  
- `avg_raiting`, `-avg_raiting` — по среднему рейтингу  
- `real_price_usd`, `-real_price_usd` — по цене в USD  
- `flag_is_new`, `-flag_is_new` — по новизне  
- `flag_is_good_deal`, `-flag_is_good_deal` — по выгодности предложения  

### Прочие поля

| Ключ в запросе | Описание | Тип поля | Обязательность | Пример значения |
|----------------|----------|----------|----------------|------------------|
| `is_good_for_promo` | Признак «подходит для промо» | CharField | опционально | `"1"` |
| `from_modal` | Признак запроса из модального окна | CharField | опционально | `"1"` |
| `variant_1`, `variant_3`, `variant_4`, `variant_13`, `variant_24`, `variant_25` | Варианты товара (можно несколько значений по каждому ключу) | ModelMultipleChoiceField | опционально | `[1, 2]` |

## Примеры использования

### Поиск по тексту и диапазону цены

```json
POST api/products/search
Content-Type: application/json

{
  "search_string": "ноутбук",
  "price_from": 30000,
  "price_to": 80000,
  "ordering": "-real_price_usd"
}
```

### Только новые товары со скидкой

```json
{
  "only_new": "true",
  "with_discount": "true",
  "ordering": "-popularity"
}
```

### Товары из списка желаемого (нужна авторизация)

```json
{
  "show_whishlist": "true",
  "ordering": "avg_raiting"
}
```

### Фильтр по рейтингу и числу отзывов

```json
{
  "avg_raiting_from": 4,
  "c_aprooved_feedbacks_from": 10,
  "ordering": "-avg_raiting"
}
```

## Формат ответа

Успешный ответ возвращает структуру с массивом товаров и метаданными (например, общее количество, страница). Точный набор полей зависит от API; типичный фрагмент:

```json
{
  "products": [
    {
      "id": 123,
      "name": "Название товара",
      "price": 1999.99,
      "discount": 10,
      "is_new": true,
      "is_featured": true,
      "avg_rating": 4.5,
      "popularity": 1250
    }
  ],
  "total": 42,
  "page": 1
}
```

## Примечания

- Все параметры опциональны; можно комбинировать любые фильтры.
- Для `show_whishlist` нужна авторизация пользователя.
- В полях с суффиксами `_from` и `_to` границы диапазона включительные.
- В API в названиях используется орфография оригинала (например, `avg_raiting`, `whishlist`).
